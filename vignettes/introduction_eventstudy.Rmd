---
title: "Introductionary Use Case: Firm addition to S&P500"
author: "Dr. Markus Schimmer and Dr. Simon MÃ¼ller"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Motivation

The attached sample data and request files were constructed to illustrate the use of the EventStudyTools R-package. 

The files hold data about the addition of several well known firms to the S&P 500 index in the late 1990s. With this data, the R package will investigate for you the question whether a company's stock value increases if the firm is added to the S&P 500 index. This is a common research question and has been adressed, among others, by Anthony W. Lynch and Richard R. Mendenha in a 1997 study: They found a positive effect of about 3.8% over the period starting the day after the announcement and ending the day before the effective date of the change (Mergers & Acquistions)[https://www.eventstudytools.com/mergers-acquisitions].

You can use our R-package to easily investigate such and similar questions.

## Data File Description

For performing an Event Study we need three files (file names can be chosen arbitrarly):

1. A request file where the structure of the Event Study is defined
2. A firm data file containing the stock data for each firm defined in the request file
3. A market data file containing the reference market data (multiple reference markets per study are possible)

All files must be saved without header, semi-colon separated and dates has to be in following format: `30.04.1997`. In next section we will descripe the file structure based on the S&P 500 example Event Study more detailed. You always find more information (if necessary) on our website: [EventStudyTools](https://www.eventstudytools.com/instructions-axc).

We added the S&P 500 example Event Study to this package. The three necessary files can be easily generated by following command: 
```{r, message=FALSE, warning=FALSE, results='hide'}
library(EventStudy)
getSP500ExampleFiles()
```

We named the request and data files in following manner:

- `01_RequestFile.csv`
- `02_FirmData.csv`
- `03_MarketData.csv`

In your analysis, you can name them as you want.

### Event Definitions: `01_RequestFile.csv`

This csv file contains the event definitions. It contains 9 columns. The order must be in the following way, as the columns are not named in the csv. 

- **Event ID** [Integer]: A unique event identifier. 
- **Firm ID** [String]: The firm name or stock ID. This ID must match the ID in the firm data.
- **Market ID** [String]: The reference market ID. This ID must match the ID in the market data.
- **Event Date** [`30.04.1997`]: Date of the event.  
- **Grouping Variable** [String]: This column is used to group events. Most test statistics are based on looking at groups.
- **Start Event Window** [Integer]: This integer value defines the start of the event window. This value must smaller or equal zero (e.g. trading days before event). 
- **End Event Window** [Integer]: This integer value defines the end of the event window. This value must greater or equal zero (e.g. trading days after event).
- **End of Estimation Window** [Integer]: This negative value defines the end of the estimation window (counted from event day). 
- **Estimation Window Length** [Integer]: Length of the estimation window.

In the following example, we have an event window of `[-2, 2]` (an event window of length `5`), an estimation window of length `120`, and the estimation window ends `11` days before the event.

```{r, message=FALSE}
library(readr)
df <- readr::read_csv2("01_RequestFile.csv", col_names = F)
names(df) <- c("Event ID", "Firm ID", "Market ID", "Event Date", "Grouping Variable", "Start Event Window", "End Event Window", "End of Estimation Window", "Estimation Window Length")
knitr::kable(df)
```

### Firm Data: `02_FirmData.csv`

The stock data for each firm defined in the request file. It contains 3 columns.

- **Firm ID** [String]:  The firm or stock ID. This ID must match the ID in the Firm ID in the request file.
- **Date** [`30.04.1997`]: Dateof the closing price.
- **Closing Price** [Double]: Closing price of volume of that day.

The following table shows the first `20` entries of our example firm data.

```{r, message=FALSE}
library(readr)
df <- readr::read_csv2("02_FirmData.csv", col_names = F)
names(df) <- c("Firm ID", "Date", "Closing Price")
knitr::kable(head(df))
```


### Firm Data: `03_MarketData.csv`

This file is similary structured as `02_FirmData.csv`:

- **Market ID** [String]:  The market ID or stock ID. This ID must match the ID in the Market ID in the request file.
- **Date** [`30.04.1997`]: Date of the closing price.
- **Closing Price** [Double]: Closing price of volume of that day.

The following table shows the first `20` entries of our example firm data.

```{r, message=FALSE}
library(readr)
df <- readr::read_csv2("03_MarketData.csv", col_names = F)
names(df) <- c("Market ID", "Date", "Closing Price")
knitr::kable(head(df))
```

You are also able to apply a *Fama-French 3-Factor Model* or a *Fama-French Momentum-4-Factor Model*. This will change the neccessary data you need for performing an Event Study (e.g. by adding Fama-French Factors). You find more information at [https://www.eventstudytools.com/instructions-axc](https://www.eventstudytools.com/instructions-axc).


## Perform an Event Study from R

### Authentication

For performing an Event Study with our API you need:

- API url (defaults to `http://api.eventstudytools.com`)
- API key. 

You get a **free** API key from our website [TODO: Link to Site](http://eventstudytools.com). In the first step we need to authenticate to the web API.

```{r, eval=FALSE}
apiUrl <- "http://api.dev.eventstudytools.com"
apiKey <- "XXX"

# Setup API Connection
estSetup <- EventStudyAPI$new("http://api.dev.eventstudytools.com")
estSetup$authentication(apiKey = "8dcd259734fa8c665fb1ab355fe2c1dc")
```

We build 

### The fast path

```{r, eval=FALSE} 
estSetup$configureTask()
estSetup$uploadFile(fileKey = "request_file", fileName = "01_RequestFile.csv")
estSetup$uploadFile(fileKey = "firm_data", fileName = "02_firmData.csv")
estSetup$uploadFile(fileKey = "market_data", fileName = "03_marketData.csv")
estSetup$commitData()

estSetup$processTask()

estSetup$getTaskStatus()
estSetup$getTaskResults()
```

### The detailed path

